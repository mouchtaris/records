#!/usr/bin/env bash

source libbootstrap.bash

###
### ## Argument Check
###
if [[ $(($#)) < 1 ]]
then
  _err_and_die "$( printf 'Syntax:\n  %s ENV\n\n  ENV:\n    One of the environments in %s' "$0" "$_envs_dir" )"
fi

env=$1; shift;
if [ -z "$env" ]
then
  _err_and_die 'ENV (argv[0]) cannot be empty'
fi

_configure "$env"

for pkg in \
  pyenv \
  python \
  pip \
  psycopg
do
  _install_pkg "$pkg" || _err_and_die "$( printf 'Failed while installing unless installed: %s' "$pkg" )"
done &&
exit 0 ||
exit 1

pip install --user psycopg2-binary &&
env AIRFLOW_GPL_UNIDECODE=yes pip install --user apache-airflow'[celery, crypto, s3, kubernetes]' &&
sudo mkdir -p /var/postgresql &&
sudo chmod 777 /var/postgresql &&
pg_ctl initdb &&
pg_ctl start &&
createuser airf &&
createdatabase airf &&
true
